{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Select Summary Option</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}"/>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&display=swap"
          rel="stylesheet">
    <script src="{% static 'js/bootstrap.bundle.js' %}"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <style>
        body {
            background: #080F2B;
            font-family: 'Rajdhani', sans-serif;
            color: #12A78A;
        }

        .head {
            font-size: 80px;
            font-weight: 300;
            text-align: left;
            color: #fff;
        }

        .head hr {
            border: 1px solid #12A78A;
            width: 100%;
            margin: 0;
        }

        .link {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: white;
            text-decoration: none;
            text-align: center;
            position: relative; /* Added for positioning the description */
        }

        .link:hover {
            text-decoration: underline;
            color: #12A78A;
        }

        .circle {
            width: 90px;
            height: 90px;
            background-color: #12A78A;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.2s ease-in-out;
            font-size: 40px;
            color: #080F2B;
        }

        .circle:hover {
            transform: scale(1.1);
            cursor: pointer;
        }

        .description {
            font-size: 14px; /* Adjust as needed */
            color: #bbb; /* Lighter color for description */
            margin-top: 5px; /* Space between title and description */
            max-width: 150px; /* Limit width of description */
        }
        .click-here {
            color: #12A78A; /* Highlight "click here" */
            cursor: pointer;
            text-decoration: underline;
        }

        #listeningStatus {
            margin-top: 20px;
            font-size: 20px;
            color: #fff;
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }

        .stopCircle {
            width: 90px;
            height: 90px;
            background-color: #ff4d4d;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            color: #fff;
            transition: transform 0.2s ease-in-out;
        }

        .stopCircle:hover {
            transform: scale(1.1);
            cursor: pointer;
            background-color: #ff1a1a;
        }

        #statusText {
            font-size: 20px;
            margin-bottom: 10px;
        }

        #getSummaryButton {
            display: none;
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #12A78A;
            border: none;
            border-radius: 10px;
            color: #080F2B;
            cursor: pointer;
        }

        #getSummaryButton:hover {
            background-color: #0f8f73;
        }
    </style>
</head>
<body>
<div class="head container text-white">
    <p class="pt-5 mb-0">Summary</p>
    <hr class="mt-0">
</div>

<div class="container text-center mt-5">
    <div class="d-flex flex-column gap-4 align-items-center">
        <div id="voiceLink" class="link">
            <div id="microphone" class="circle">
                <i class="bi bi-mic-fill"></i>
            </div>
            <span id="voiceText">Generate from Voice</span>
            <div class="description">
                Record your voice to create a summary. <span class="click-here" onclick="document.getElementById('voiceLink').click();">Click here</span> to start.
            </div>
        </div>

        <a href="{% url 'summary_notes' %}" id="notesLink" class="link">
            <div id="import" class="circle">
                <i class="bi bi-upload"></i>
            </div>
            <input type="file" id="notesFile" style="display: none;" accept=".txt,.pdf,.doc,.docx" />
            <span>Generate from Notes</span>
            <div class="description">
                Upload your documents (text, PDF, Word) for summarization. <span class="click-here" onclick="document.getElementById('notesFile').click();">Click here</span> to upload.
            </div>
        </a>
    </div>

    <div id="listeningStatus">
        <div id="statusText">Currently Listening...</div>
        <div id="stopButton" class="stopCircle">
            <i class="bi bi-stop-fill"></i>
        </div>
    </div>

   <button id="getSummaryButton">Get Summary</button>

</div>

<script>
    const voiceLink = document.getElementById('voiceLink');
    const voiceText = document.getElementById('voiceText');
    const listeningStatus = document.getElementById('listeningStatus');
    const stopButton = document.getElementById('stopButton');
    const notesLink = document.getElementById('notesLink');
    const notesFile = document.getElementById('notesFile'); // Get the file input
    const getSummaryButton = document.getElementById('getSummaryButton');

    let recognition;
    if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;
    } else {
        alert("Your browser does not support speech recognition.");
    }

    voiceLink.addEventListener('click', () => {
        if (recognition) {
            recognition.start();
            listeningStatus.style.display = 'flex';
            if (notesLink) notesLink.style.display = 'none';
        }
    });

    stopButton.addEventListener('click', () => {
        if (recognition) {
            recognition.stop();
            listeningStatus.style.display = 'none';
            if (notesLink) notesLink.style.display = 'flex';
            voiceText.textContent = 'Continue Listening';
            getSummaryButton.style.display = 'inline-block';
        }
    });

    recognition && (recognition.onend = () => {
        listeningStatus.style.display = 'none';
        if (notesLink) notesLink.style.display = 'flex';
    });

    // Event listener for the "Generate from Notes" link to trigger file input
    notesLink.addEventListener('click', (event) => {
        // Prevent the default link behavior if the click is directly on the link itself
        // unless the click is specifically on the file input, which will handle itself.
        if (event.target !== notesFile && !event.target.classList.contains('click-here')) {
             event.preventDefault(); // Stop the default link navigation
            notesFile.click(); // Programmatically click the hidden file input
        }
    });

    // Event listener for the "click here" span within the notes link description
    document.querySelector('#notesLink .click-here').addEventListener('click', (event) => {
        event.stopPropagation(); // Stop event bubbling to prevent the parent 'a' tag from navigating
        notesFile.click(); // Programmatically click the hidden file input
    });


     getSummaryButton.addEventListener('click', () => {
    window.location.href = "{% url 'summary_finalize' %}";
});

</script>
</body>
</html>